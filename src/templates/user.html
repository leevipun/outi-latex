{% extends "base.html" %}

{% block title %}K√§ytt√§j√§ - Outi LaTeX{% endblock %}
{% block body_class %}user-page{% endblock %}

{% block content %}
{% if user %}
    <div id="user-page-container">
        <!-- Viitteet osio (ensimm√§isen√§) -->
        <div class="user-references-section">
            <h1>Omat viitteeni</h1>
            <hr/>

            {% if references %}
                <p class="references-count">Yhteens√§ {{ references|length }} viitett√§</p>

                <div class="references-list">
                    {% for reference in references %}
                    <div class="reference-item" id="reference-item-{{ reference['bib_key'] }}">
                        <div class="reference-header">
                            <h3>{{ reference['bib_key'] }}</h3>

                            <!-- N√§kyvyystila -->
                            {% if reference.get('is_public') == False %}
                            <span class="visibility-badge private">üîí Yksityinen</span>
                            {% else %}
                            <span class="visibility-badge public">üì¢ Julkinen</span>
                            {% endif %}
                        </div>

                        <p><strong>Tyyppi:</strong> {{ reference['reference_type'] }}</p>
                        <p><strong>Luotu:</strong> {{ reference['created_at'] }}</p>

                        <!-- Kent√§t -->
                        <div class="reference-fields">
                            {% for key, value in reference['fields'].items() %}
                            <p><strong>{{ key }}:</strong> {{ value }}</p>
                            {% endfor %}
                        </div>

                        <!-- Tagi -->
                        {% if reference.get('tag') %}
                        <p class="reference-tag">
                            <span class="tag-badge">üè∑Ô∏è {{ reference['tag']['name'] }}</span>
                        </p>
                        {% endif %}

                        <!-- Toiminnot -->
                        <div class="reference-actions">
                            <a href="/edit/{{ reference['bib_key'] }}" class="btn btn-edit">Muokkaa</a>
                            <form action="/delete/{{ reference['bib_key'] }}" method="POST" style="display:inline;">
                                <button type="submit" class="btn btn-delete"
                                        onclick="return confirm('Haluatko varmasti poistaa viitteen {{ reference['bib_key'] }}?')">
                                    Poista
                                </button>
                            </form>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="no-references">
                    <p>Et ole viel√§ lis√§nnyt yht√§√§n viitett√§.</p>
                    <a href="/" class="btn btn-primary">Lis√§√§ ensimm√§inen viite</a>
                </div>
            {% endif %}
        </div>

        <hr style="margin: 40px 0;"/>

        <!-- Asetukset osio -->
        <div id="user-settings-container">
            <h1 id="user-settings-title">K√§ytt√§j√§asetukset</h1>
            <hr/>

            <!-- Email Change Form -->
            <div class="settings-section">
                <h2 id="email-section-title">Vaihda s√§hk√∂postiosoite</h2>
                <form action="/update_email" method="post" id="email-form">
                    <div class="form-group">
                        <label for="current_email" id="current-email-label">
                            Nykyinen s√§hk√∂postiosoite
                        </label>
                        {{ user.email }}
                        <small class="helper-text">T√§m√§ on nykyinen s√§hk√∂postiosoitteesi</small>
                    </div>

                    <div class="form-group">
                        <label for="new_email" id="new-email-label">
                            Uusi s√§hk√∂postiosoite <span class="required">*</span>
                        </label>
                        <input type="email"
                               id="new_email"
                               name="new_email"
                               placeholder="uusi@email.com"
                               required>
                        <small class="helper-text">Sy√∂t√§ uusi s√§hk√∂postiosoitteesi</small>
                    </div>

                    <div class="form-group">
                        <label for="confirm_email" id="confirm-email-label">
                            Vahvista uusi s√§hk√∂postiosoite <span class="required">*</span>
                        </label>
                        <input type="email"
                               id="confirm_email"
                               name="confirm_email"
                               placeholder="uusi@email.com"
                               required>
                        <small class="helper-text">Sy√∂t√§ uusi s√§hk√∂postiosoite uudelleen</small>
                    </div>

                    <div class="button-group">
                        <button type="submit" class="button-primary" id="update-email-button">
                            P√§ivit√§ s√§hk√∂postiosoite
                        </button>
                    </div>
                </form>
            </div>

            <!-- Password Change Form -->
            <div class="settings-section">
                <h2 id="password-section-title">Vaihda salasana</h2>
                <form action="/update_password" method="post" id="password-form">
                    <div class="form-group">
                        <label for="current_password" id="current-password-label">
                            Nykyinen salasana <span class="required">*</span>
                        </label>
                        <input type="password"
                               id="current_password"
                               name="current_password"
                               required>
                        <small class="helper-text">Sy√∂t√§ nykyinen salasanasi vahvistusta varten</small>
                    </div>

                    <div class="form-group">
                        <label for="new_password" id="new-password-label">
                            Uusi salasana <span class="required">*</span>
                        </label>
                        <input type="password"
                               id="new_password"
                               name="new_password"
                               required
                               minlength="8">
                        <small class="helper-text">Salasanan tulee olla v√§hint√§√§n 8 merkki√§ pitk√§</small>
                    </div>

                    <div class="form-group">
                        <label for="confirm_password" id="confirm-password-label">
                            Vahvista uusi salasana <span class="required">*</span>
                        </label>
                        <input type="password"
                               id="confirm_password"
                               name="confirm_password"
                               required
                               minlength="8">
                        <small class="helper-text">Sy√∂t√§ uusi salasana uudelleen</small>
                    </div>

                    <div class="button-group">
                        <button type="submit" class="button-primary" id="update-password-button">
                            P√§ivit√§ salasana
                        </button>
                    </div>
                </form>
            </div>

            <!-- Back to Home Link -->
            <div class="navigation-links">
                <a href="/" id="back-to-home" class="btn">‚Üê Takaisin etusivulle</a>
            </div>
        </div>
    </div>
{% endif %}
{% endblock %}