<!DOCTYPE html>
<html>
<head>
    <title>Kaikki viitteet - Outi LaTeX</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        <div class="flash-messages">
            {% for category, message in messages %}
            <div class="alert alert-{{ category }}" id="alert-{{ category }}">
                {{ message }}
            </div>
            {% endfor %}
        </div>
        {% endif %}
    {% endwith %}
    <div class="container">
        <h1 id="all-references-title">Kaikki viitteet</h1>
        {% if data %}
        {% for reference in data %}
            <div class="reference-item" id="reference-item-{{ reference['bib_key'] }}">
                <h3 id="reference-key-{{ reference['bib_key'] }}">{{ reference["bib_key"] }}</h3>
                <ul id="reference-meta-{{ reference['bib_key'] }}">
                    <li id="reference-type-{{ reference['bib_key'] }}">{{ reference["reference_type"] }}</li>
                    <li id="reference-date-{{ reference['bib_key'] }}">{{ reference["created_at"] }}</li>
                </ul>
                <ul class="fields-list" id="reference-fields-{{ reference['bib_key'] }}">
                    {% for key, value in reference["fields"].items() %}
                        <li id="field-{{ reference['bib_key'] }}-{{ key }}"><strong>{{ key }}:</strong> <span id="value-{{ reference['bib_key'] }}-{{ key }}">{{ value }}</span></li>
                    {% endfor %}
                </ul>
                <form 
                    method="get"
                    action="/edit/{{ reference['bib_key'] }}" 
                    style="display:inline;">
                    <button id="edit-button-{{ reference['bib_key'] }}" type="submit">Muokkaa</button>
                </form>
                <form 
                    method="post" 
                    action="{{ url_for('delete_reference', bib_key=reference['bib_key']) }}" 
                    style="display:inline;"
                    onsubmit="return confirm('Haluatko varmasti poistaa t√§m√§n viitteen?');"
                >
                    <input type="hidden" name="bib_key" value="{{ reference['bib_key'] }}">
                    <button type="submit" id="delete-button-{{reference['bib_key']}}">Poista</button>
                </form>
            </div>
        {% endfor %}
        {% else %}
        <div class="no-references" id="no-references-div">
            <h2 id="no-references-title">Ei viitteit√§ lis√§ttyn√§</h2>
            <p id="no-references-message">Et ole viel√§ lis√§nnyt viitteit√§. Voit lis√§t√§ viitteit√§ etusivulta.</p>
        </div>
        {% endif %}
        <br/>
        <a href="/" id="back-to-home-button" class="btn">Etusivu</a>
        <a href="/search" class="btn" id="view-all-references-button">Hae viitteit√§</a>
        {% if data %}
            <a href="/export/bibtex"
            id="export-bibtex-button"
            class="button button-primary"
            download="references.bib"
            style="margin-left: 10px; background: #28a745;">
            üìÑ Lataa BibTeX (.bib)
        </a>
        {% endif %}
    </div>
</body>
</html>